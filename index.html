<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>OTP 驗證表單</title>
<style>
  label { display:block;margin-top:10px; }
  .otp-area { display:none; }
</style>
</head>
<body>

<h2>報名表</h2>

<form id="myForm">
  <label>姓名 <input id="name" required></label>
  <label>出生年月日 <input id="birthday" type="date" required></label>
  <label>Email <input id="email" type="email" required></label>

  <label>性別
    <input type="radio" name="gender" value="男" required>男
    <input type="radio" name="gender" value="女">女
  </label>

  <label>手機（去掉 0，例如：912345678）<input id="phone" required></label>
  <button type="button" id="sendOtp">發送 OTP</button>

  <div class="otp-area">
    <label>輸入驗證碼 <input id="otp" required></label>
    <button type="button" id="verifyOtp">提交驗證碼</button>
    <span id="otpResult"></span>
  </div>

  <label>目前有做哪些規劃？</label>
  <label><input type="checkbox" class="plan" value="健康險">健康險</label>
  <label><input type="checkbox" class="plan" value="意外險">意外險</label>
  <label><input type="checkbox" class="plan" value="分紅保單">分紅保單</label>
  <label><input type="checkbox" class="plan" value="目前都沒有">目前都沒有</label>

  <br>
  <button id="submitBtn" disabled>送出</button>
</form>

<script>
const ZAP_WEBHOOK = "https://hooks.zapier.com/hooks/catch/24264918/utmia7n/";
let generatedOtp = "";

// 按下發送時產生6位OTP
document.getElementById("sendOtp").onclick = async function(){
  const phoneVal = document.getElementById("phone").value;
  if(!phoneVal) return alert("請先填手機號碼");
  // 產生 6 位驗證碼
  generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
  
  await fetch(ZAP_WEBHOOK,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:"send_sms", phone:`+886${phoneVal}`, otp:generatedOtp})
  });
  alert("驗證碼已發送到手機，請查看簡訊");
  document.querySelector('.otp-area').style.display='block';
};

// 檢核使用者輸入
document.getElementById("verifyOtp").onclick = async function(){
  const otpVal = document.getElementById("otp").value;
  if(otpVal === generatedOtp){
    document.getElementById("otpResult").innerText = "✅ 驗證成功";
    document.getElementById("submitBtn").disabled = false;
  } else {
    alert("驗證失敗，請重新輸入");
  }
};
</script>

</body>
</html>
