<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>OTP 驗證表單</title>
<style>
  label{display:block;margin-top:10px;}
  .otp-area{display:none;}
</style>
</head>
<body>
<h2>報名表</h2>

<form id="myForm">
  <label>姓名 <input id="name" required></label>
  <label>出生年月日 <input id="birthday" type="date" required></label>
  <label>E-mail <input id="email" type="email" required></label>

  <label>性別
      <input type="radio" name="gender" value="男" required>男
      <input type="radio" name="gender" value="女">女
  </label>

  <label>手機 <input id="phone" required></label>
  <button type="button" id="sendOtp">發送OTP</button>

  <div class="otp-area">
    <label>輸入驗證碼 <input id="otp"></label>
    <button type="button" id="verifyOtp">驗證送出</button>
    <span id="otpResult"></span>
  </div>

  <label>目前有做哪些規劃？</label>
  <label><input type="checkbox" class="plan" value="健康險">健康險</label>
  <label><input type="checkbox" class="plan" value="意外險">意外險</label>
  <label><input type="checkbox" class="plan" value="分紅保單">分紅保單</label>
  <label><input type="checkbox" class="plan" value="目前都沒有">目前都沒有</label>

  <br>
  <button id="submitBtn" disabled>送出</button>
</form>

<script>
// TODO: 這裡先使用假OTP驗證：密碼固定輸入 123456 即成功
let isOtpPassed = false;

document.getElementById("sendOtp").onclick = function(){
  alert("驗證碼已發送到你輸入的手機（測試版請直接填 123456）");
  document.querySelector(".otp-area").style.display = "block";
};

document.getElementById("verifyOtp").onclick = function(){
  const otp = document.getElementById("otp").value;
  if(otp == "123456"){
    isOtpPassed = true;
    document.getElementById("otpResult").textContent = "✅ 驗證成功";
    document.getElementById("submitBtn").disabled = false;
  }else{
    document.getElementById("otpResult").textContent = "❌ 驗證失敗";
  }
};

document.getElementById("myForm").onsubmit = function(e){
  e.preventDefault();
  if(!isOtpPassed){ alert("請先完成手機驗證"); return; }

  const data = {
    name:     document.getElementById("name").value,
    birthday: document.getElementById("birthday").value,
    email:    document.getElementById("email").value,
    gender:   document.querySelector('input[name="gender"]:checked').value,
    phone:    document.getElementById("phone").value,
    plan:     Array.from(document.querySelectorAll(".plan:checked")).map(x=>x.value)
  };

  fetch("https://script.google.com/macros/s/AKfycby2EnrdiuB18dVV55DaTwaRh5r_b7X7s5TdakpS-25j58h8k8xOD6wOtm_mc_y3seSA/exec",{
    method:"POST",
    body:JSON.stringify(data)
  }).then(r=>r.text())
    .then(res=>{
      alert("送出成功！");
      window.location.href="success.html"; // ✔️ 有網址時改成你的成功頁
    });
}
</script>
</body>
</html>
